import {
  cannonSet,
  loadCannon_default,
  scene_default
} from "./chunk-VAFQCDDA.js";
import "./chunk-MO2ISMHQ.js";
import "./chunk-2PNJ75KS.js";
import "./chunk-J7HA7FW3.js";
import "./chunk-NXCTIVNA.js";
import "./chunk-57VJUUAA.js";
import "./chunk-XA4H47DG.js";

// node_modules/lingo3d/lib/display/core/mixins/PhysicsMixin/enableCannon.js
var physicsGroups = [1, 2, 4, 8, 16, 32];
var physicsGroupIndexes = [0, 1, 2, 3, 4, 5];
async function enableCannon_default(handle) {
  var _a, _b;
  if (handle.done)
    return;
  scene_default.attach(this.outerObject3d);
  const { slipperyMaterial, defaultMaterial, world, Body, Vec3 } = await loadCannon_default();
  if (handle.done)
    return;
  const body = this.cannonBody = new Body({
    mass: (_a = this._mass) != null ? _a : 1,
    material: this._slippery ? slipperyMaterial : defaultMaterial,
    collisionFilterGroup: physicsGroups[(_b = this._physicsGroup) != null ? _b : 0],
    collisionFilterMask: physicsGroupIndexes.filter((index) => {
      var _a2;
      return !((_a2 = this._ignorePhysicsGroups) == null ? void 0 : _a2.includes(index));
    }).map((index) => physicsGroups[index]).reduce((acc, curr) => acc + curr, 0)
  });
  await this.physicsShape();
  if (handle.done)
    return;
  if (this._physics === "2d") {
    body.angularFactor = new Vec3(0, 0, 1);
    body.linearFactor = new Vec3(1, 1, 0);
  }
  if (this._noTumble)
    body.angularFactor = new Vec3(0, 0, 0);
  body.position.copy(this.outerObject3d.position);
  body.quaternion.copy(this.outerObject3d.quaternion);
  this.physicsUpdate = {};
  world.addBody(body);
  cannonSet.add(this);
  handle.then(() => {
    world.removeBody(body);
    cannonSet.delete(this);
    this.cannonBody = void 0;
    this.physicsUpdate = void 0;
  });
}
export {
  enableCannon_default as default
};
//# sourceMappingURL=enableCannon-J62CHCKV.js.map
