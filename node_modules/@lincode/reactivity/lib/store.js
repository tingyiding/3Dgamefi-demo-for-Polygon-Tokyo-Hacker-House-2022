import { event } from "@lincode/events";
import { Cancellable } from "@lincode/promiselikes";
const globalStateGetters = new WeakSet();
export const isGlobalState = (getter) => (globalStateGetters.has(getter));
export const store = (data) => {
    const [, onData, setData, getData] = event();
    setData(data);
    //@ts-ignore
    const getGlobalState = (cb) => {
        if (cb) {
            const handle = new Cancellable();
            handle.watch(onData(v => cb(v, handle)));
            return handle;
        }
        return getData();
    };
    globalStateGetters.add(getGlobalState);
    return [setData, getGlobalState];
};
