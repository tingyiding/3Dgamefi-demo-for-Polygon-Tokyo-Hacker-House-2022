import { useLayoutEffect, useState } from "react"
import ResizeObserver from "resize-observer-polyfill"

export default (cb?: (size: readonly [number, number]) => void) => {
    const [el, setEl] = useState<HTMLElement | null>(null)
    const [size, setSize] = useState<readonly [number, number]>([0, 0])

    useLayoutEffect(() => {
        if (!el) return
        
        const resizeObserver = new ResizeObserver(() => {
            const size = <const>[el.clientWidth, el.clientHeight]
            cb?.(size)
            setSize(size)
        })
        resizeObserver.observe(el)

        return () => {
            resizeObserver.disconnect()
        }
    }, [el])
    
    return <const>[setEl, size, el]
}